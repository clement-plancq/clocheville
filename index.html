<html>

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <title>Sectorisation des écoles élémentaires de Tours</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
        integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css"
        integrity="sha384-X38yfunGUhNzHpBaEBsWLO+A0HDYOQi8ufWDkZ0k9e0eXz/tH3II7uKZ9msv++Ls" crossorigin="anonymous">
    <style>
        body {
            margin-left: 10rem;
            margin-right: 10rem;
        }

        #map {
            height: 700px;
            width: 1000px;
        }
    </style>
</head>

<body>
    <h1>Sectorisation des écoles élémentaires de Tours centre</h1>

    <p>La carte reprend les jeux de données suivants : </p>
    <ul>
        <li>Coordonnées géo des secteurs : <a
                href="https://data.tours-metropole.fr/explore/dataset/sectorisation_ecole_elementaire/"
                target="_blank">https://data.tours-metropole.fr/explore/dataset/sectorisation_ecole_elementaire/</a>
        </li>
        <li>Capacités : <a href="https://data.tours-metropole.fr/explore/dataset/ecoles-tours-metropole-val-de-loire/"
                target="_blank">https://data.tours-metropole.fr/explore/dataset/ecoles-tours-metropole-val-de-loire/</a>
        </li>
        <li>Indices de position sociale (IPS) : <a
                href="https://data.education.gouv.fr/explore/dataset/fr-en-ips-ecoles-ap2022/"
                target="_blank">https://data.education.gouv.fr/explore/dataset/fr-en-ips-ecoles-ap2022/</a>
        </li>
        <li>Effectifs (pour Clocheville) : <a
                href="https://data.tours-metropole.fr/explore/dataset/effectif-scolaire-tmvl/"
                target="_blank">https://data.tours-metropole.fr/explore/dataset/effectif-scolaire-tmvl/</a>
        </li>
    </ul>

    <p>Cliquez sur un secteur pour afficher les informations</p>

    <div id="map"></div>

    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
        integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>

    <script>
        function getColor(nom) {
            if (nom === "Clocheville") {
                return "#0096FF";
            }
            return "#89CFF0";
        }

        function style(feature) {
            return {
                fillColor: getColor(feature.properties.nom),
                weight: 2,
                opacity: 1,
                color: 'white',
                dashArray: '2',
                fillOpacity: 0.7
            };
        }

        function highlightFeature(e) {
            var layer = e.target;

            layer.setStyle({
                weight: 5,
                color: '#666',
                dashArray: '',
                fillOpacity: 0.7
            });

            layer.bringToFront();
        }

        function resetHighlight(e) {
            geojson.resetStyle(e.target);
        }

        function zoomToFeature(e) {
            map.fitBounds(e.target.getBounds(), 10);
        }

        function onEachFeature(feature, layer) {
            if (feature.properties.nom && feature.properties.capacites) {
                let message = `<h2>${feature.properties.nom}</h2>Capacité : ${feature.properties.capacites}<br/>IPS : ${feature.properties.ips}<br/>`;
                if (feature.properties.nom === "Clocheville") {
                    message += "Effectifs : <br/><table class=\"pure-table pure-table-bordered\"><tr><td>2019</td><td>138</td></tr><tr><td>2020</td><td>135</td></tr><tr><td>2021</td><td>138</td></tr><tr><td>2022</td><td>127</td></tr><tr><td>2023</td><td>111</td></tr></table>";
                }
                layer.bindPopup(message);
                layer.bindTooltip(feature.properties.nom, {
                    direction: "center",
                    permanent: true,
                });
            }
            /*layer.on({
                click: zoomToFeature
            });*/
        }
        var map = L.map('map').setView([47.39088007951175, 0.6840561446981597], 14);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        var secteurs;
        secteurs = new L.geoJson(false, {
            onEachFeature: onEachFeature,
            style: style
        });
        secteurs.addTo(map);

        fetch('sectorisation_ecole_elementaire.geojson')  // Replace with your GeoJSON file path
            .then(response => response.json())
            .then(data => {
                data.features.forEach(item => secteurs.addData(item));
            });

    </script>
</body>

</html>